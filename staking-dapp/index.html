<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DogeRocket Staking dApp</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <script src="https://unpkg.com/@web3modal/ethers5@3.5.4/dist/index.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/remixicon@4.3.0/fonts/remixicon.css" rel="stylesheet">
  <style>
    @keyframes twinkle {
      0% { opacity: 0.5; }
      50% { opacity: 1; }
      100% { opacity: 0.5; }
    }
    .stars {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      width: 100%;
      height: 100%;
      display: block;
      background: transparent;
      z-index: -1;
      pointer-events: none;
    }
    .stars::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(2px, white 2px, transparent 2px);
      background-size: 50px 50px;
      animation: twinkle 2s ease-in-out infinite alternate;
      opacity: 0.3;
    }
    .stars::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(1px, white 1px, transparent 1px);
      background-size: 30px 30px;
      animation: twinkle 3s ease-in-out infinite alternate;
      opacity: 0.5;
    }
    body {
      overflow-y: auto;
    }
  </style>
</head>
<body class="bg-gradient-to-b from-blue-900 to-blue-500 text-white min-h-screen font-sans">
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect } = React;
    const { ethers } = window.ethers;
    // Production values
    const CONTRACT_ADDRESS = "0x03720cc99a302c101dbd48489a6c2c8bb52d178d";
    const CHAIN_ID = 137; // Polygon Mainnet
    const RPC_URL = "https://polygon-mainnet.infura.io/v3/4e16c4dd948a444ba97a4cdb992b33d1";
    const LOGO_URL = "https://gray-past-falcon-384.mypinata.cloud/ipfs/bafkreign7g276yq7ss6cqo7gtnrbvwrh5qbxmhgboamwdoiy5sv5lo6j4i";
    const ABI = [
      {"inputs":[],"stateMutability":"nonpayable","type":"constructor"},
      {"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"allowance","type":"uint256"},{"internalType":"uint256","name":"needed","type":"uint256"}],"name":"ERC20InsufficientAllowance","type":"error"},
      {"inputs":[{"internalType":"address","name":"sender","type":"address"},{"internalType":"uint256","name":"balance","type":"uint256"},{"internalType":"uint256","name":"needed","type":"uint256"}],"name":"ERC20InsufficientBalance","type":"error"},
      {"inputs":[{"internalType":"address","name":"approver","type":"address"}],"name":"ERC20InvalidApprover","type":"error"},
      {"inputs":[{"internalType":"address","name":"receiver","type":"address"}],"name":"ERC20InvalidReceiver","type":"error"},
      {"inputs":[{"internalType":"address","name":"sender","type":"address"}],"name":"ERC20InvalidSender","type":"error"},
      {"inputs":[{"internalType":"address","name":"spender","type":"address"}],"name":"ERC20InvalidSpender","type":"error"},
      {"inputs":[{"internalType":"address","name":"owner","type":"address"}],"name":"OwnableInvalidOwner","type":"error"},
      {"inputs":[{"internalType":"address","name":"account","type":"address"}],"name":"OwnableUnauthorizedAccount","type":"error"},
      {"inputs":[{"internalType":"address","name":"token","type":"address"}],"name":"SafeERC20FailedOperation","type":"error"},
      {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"spender","type":"address"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"Approval","type":"event"},
      {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"wallet","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"LockedTokensClaimed","type":"event"},
      {"anonymous":false,"inputs":[{"indexed":false,"internalType":"string","name":"newCID","type":"string"},{"indexed":false,"internalType":"string","name":"newDescription","type":"string"}],"name":"MetadataUpdated","type":"event"},
      {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"previousOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},
      {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"reward","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"timestamp","type":"uint256"}],"name":"RewardClaimed","type":"event"},
      {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"sender","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"RewardPoolContribution","type":"event"},
      {"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"previousPool","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"newPool","type":"uint256"}],"name":"RewardPoolModified","type":"event"},
      {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"RewardsExpired","type":"event"},
      {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"}],"name":"StakePruned","type":"event"},
      {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"TokensStaked","type":"event"},
      {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"fee","type":"uint256"}],"name":"TokensUnstaked","type":"event"},
      {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"wallet","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"VestedTokensClaimed","type":"event"},
      {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"Transfer","type":"event"},
      {"inputs":[],"name":"LOCKED_LOCK_DURATION","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"LOCKED_VESTING_PERIODS","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"MAX_CLAIM_WINDOW","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"MAX_REWARD_RATE","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"MAX_STAKE","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"MAX_STAKE_DURATION","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"MAX_SUPPLY","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"MIN_DONATION","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"MIN_REWARD_RATE","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"MIN_STAKE","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"MIN_STAKE_DURATION","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"STAKE_COOLDOWN","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"STAKING_REWARDS_ALLOCATION","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"TARGET_POOL_COVERAGE","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"WITHDRAW_FEE","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"address","name":"spender","type":"address"}],"name":"allowance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"value","type":"uint256"}],"name":"approve","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},
      {"inputs":[{"internalType":"address","name":"account","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"calculateReward","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"claimLockedToPool","outputs":[],"stateMutability":"nonpayable","type":"function"},
      {"inputs":[],"name":"claimReward","outputs":[],"stateMutability":"nonpayable","type":"function"},
      {"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"claimVested","outputs":[],"stateMutability":"nonpayable","type":"function"},
      {"inputs":[],"name":"contractDescription","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"currentAPY","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"deploymentTime","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"dogeStakes","outputs":[{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"uint256","name":"pendingRewards","type":"uint256"},{"internalType":"uint64","name":"lastUpdateTime","type":"uint64"},{"internalType":"uint64","name":"lastActionTime","type":"uint64"},{"internalType":"uint64","name":"stakeStartTime","type":"uint64"}],"stateMutability":"view","type":"function"},
      {"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"donateToPool","outputs":[],"stateMutability":"nonpayable","type":"function"},
      {"inputs":[],"name":"lockedAmount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"lockedClaimedAmount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"metadataCID","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"name","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"renounceOwnership","outputs":[],"stateMutability":"pure","type":"function"},
      {"inputs":[],"name":"rewardPool","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[{"internalType":"string","name":"newCID","type":"string"},{"internalType":"string","name":"newDescription","type":"string"}],"name":"setMetadata","outputs":[],"stateMutability":"nonpayable","type":"function"},
      {"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"stake","outputs":[],"stateMutability":"nonpayable","type":"function"},
      {"inputs":[],"name":"symbol","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"totalStaked","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"totalSupply","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"value","type":"uint256"}],"name":"transfer","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},
      {"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"value","type":"uint256"}],"name":"transferFrom","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},
      {"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},
      {"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"unstake","outputs":[],"stateMutability":"nonpayable","type":"function"},
      {"inputs":[],"name":"vestedAmount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"vestedClaimedAmount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"}
    ];
    // Web3Modal configuration
    const projectId = "d2ef0dc4e30bb16fb86b1a73175e2261";
    let modal = null;
    if (window.Web3Modal) {
      modal = new window.Web3Modal({
        projectId,
        walletConnectVersion: 2,
        themeMode: "dark",
        themeVariables: {
          "--w3m-accent-color": "#1E40AF",
          "--w3m-background-color": "#1E3A8A"
        }
      });
    } else {
      console.error("Web3Modal not loaded");
    }
    function App() {
      const [provider, setProvider] = useState(null);
      const [signer, setSigner] = useState(null);
      const [contract, setContract] = useState(null);
      const [account, setAccount] = useState(null);
      const [balance, setBalance] = useState("0");
      const [apy, setApy] = useState("0");
      const [totalStaked, setTotalStaked] = useState("0");
      const [rewardPool, setRewardPool] = useState("0");
      const [userStake, setUserStake] = useState("0");
      const [pendingRewards, setPendingRewards] = useState("0");
      const [stakeAmount, setStakeAmount] = useState("");
      const [unstakeAmount, setUnstakeAmount] = useState("");
      const [donateAmount, setDonateAmount] = useState("");
      const [error, setError] = useState("");
      const [loading, setLoading] = useState(false);
      // Initialize provider and contract
      useEffect(() => {
        const init = async () => {
          try {
            const ethersProvider = new ethers.providers.JsonRpcProvider(RPC_URL);
            const contractInstance = new ethers.Contract(CONTRACT_ADDRESS, ABI, ethersProvider);
            setProvider(ethersProvider);
            setContract(contractInstance);
            // Fetch initial data
            const apyRaw = await contractInstance.currentAPY();
            const apyValue = parseFloat(ethers.utils.formatUnits(apyRaw, 0)) / 100;
            setApy(apyValue.toFixed(2));
            const totalStakedRaw = await contractInstance.totalStaked();
            setTotalStaked(ethers.utils.formatEther(totalStakedRaw));
            const rewardPoolRaw = await contractInstance.rewardPool();
            setRewardPool(ethers.utils.formatEther(rewardPoolRaw));
          } catch (err) {
            console.error("Error fetching initial data:", err);
            setError("Failed to load contract data. Please try again.");
          }
        };
        init();
      }, []);
      // Connect with MetaMask
      const connectMetaMask = async () => {
        if (window.ethereum) {
          try {
            setLoading(true);
            setError("");
            let ethersProvider = new ethers.providers.Web3Provider(window.ethereum);
            await window.ethereum.request({ method: 'eth_requestAccounts' });
            let chainId = Number((await ethersProvider.getNetwork()).chainId);
            if (chainId !== CHAIN_ID) {
              try {
                await window.ethereum.request({
                  method: 'wallet_switchEthereumChain',
                  params: [{ chainId: `0x${CHAIN_ID.toString(16)}` }],
                });
              } catch (switchError) {
                if (switchError.code === 4902) {
                  await window.ethereum.request({
                    method: 'wallet_addEthereumChain',
                    params: [{
                      chainId: `0x${CHAIN_ID.toString(16)}`,
                      chainName: 'Polygon Mainnet',
                      nativeCurrency: {
                        name: 'MATIC',
                        symbol: 'MATIC',
                        decimals: 18,
                      },
                      rpcUrls: ['https://polygon-rpc.com'],
                      blockExplorerUrls: ['https://polygonscan.com/'],
                    }],
                  });
                } else {
                  throw switchError;
                }
              }
              // Recreate provider after chain switch
              ethersProvider = new ethers.providers.Web3Provider(window.ethereum);
            }
            const signerInstance = ethersProvider.getSigner();
            const address = await signerInstance.getAddress();
            setSigner(signerInstance);
            setAccount(address);
            const contractWithSigner = new ethers.Contract(CONTRACT_ADDRESS, ABI, signerInstance);
            setContract(contractWithSigner);
            // Fetch user data
            const balanceRaw = await contractWithSigner.balanceOf(address);
            setBalance(ethers.utils.formatEther(balanceRaw));
            const stakeData = await contractWithSigner.dogeStakes(address);
            setUserStake(ethers.utils.formatEther(stakeData.amount));
            const rewardsRaw = await contractWithSigner.calculateReward(address);
            setPendingRewards(ethers.utils.formatEther(rewardsRaw));
          } catch (err) {
            setError("Failed to connect MetaMask: " + err.message);
          } finally {
            setLoading(false);
          }
        } else {
          setError("MetaMask not installed.");
        }
      };
      // Connect with WalletConnect
      const connectWalletConnect = async () => {
        if (!modal) {
          setError("Web3Modal not initialized. Please refresh the page.");
          return;
        }
        try {
          setLoading(true);
          setError("");
          const instance = await modal.connect();
          const ethersProvider = new ethers.providers.Web3Provider(instance);
          const signerInstance = ethersProvider.getSigner();
          const address = await signerInstance.getAddress();
          const chainId = Number((await ethersProvider.getNetwork()).chainId);
          if (chainId !== CHAIN_ID) {
            setError(`Please switch to Polygon Mainnet (Chain ID: ${CHAIN_ID})`);
            return;
          }
          setProvider(ethersProvider);
          setSigner(signerInstance);
          setAccount(address);
          const contractWithSigner = new ethers.Contract(CONTRACT_ADDRESS, ABI, signerInstance);
          setContract(contractWithSigner);
          // Fetch user data
          const balanceRaw = await contractWithSigner.balanceOf(address);
          setBalance(ethers.utils.formatEther(balanceRaw));
          const stakeData = await contractWithSigner.dogeStakes(address);
          setUserStake(ethers.utils.formatEther(stakeData.amount));
          const rewardsRaw = await contractWithSigner.calculateReward(address);
          setPendingRewards(ethers.utils.formatEther(rewardsRaw));
        } catch (err) {
          setError("Failed to connect WalletConnect: " + err.message);
        } finally {
          setLoading(false);
        }
      };
      // Disconnect wallet
      const disconnectWallet = async () => {
        try {
          if (provider && provider.provider && typeof provider.provider.close === 'function') {
            await provider.provider.close();
          }
        } catch (err) {
          console.error("Error disconnecting:", err);
        }
        setSigner(null);
        setAccount(null);
        setBalance("0");
        setUserStake("0");
        setPendingRewards("0");
        const ethersProvider = new ethers.providers.JsonRpcProvider(RPC_URL);
        const contractInstance = new ethers.Contract(CONTRACT_ADDRESS, ABI, ethersProvider);
        setContract(contractInstance);
        setProvider(ethersProvider);
      };
      // Add token to MetaMask
      const addTokenToMetaMask = async () => {
        if (!window.ethereum) {
          setError("MetaMask not installed.");
          return;
        }
        try {
          setError("");
          const wasAdded = await window.ethereum.request({
            method: 'wallet_watchAsset',
            params: {
              type: 'ERC20',
              options: {
                address: CONTRACT_ADDRESS,
                symbol: 'DRKT',
                decimals: 18,
                image: LOGO_URL,
              },
            },
          });
          if (wasAdded) {
            console.log('DRKT token added to MetaMask successfully.');
          } else {
            console.log('Failed to add DRKT token to MetaMask.');
          }
        } catch (err) {
          setError("Failed to add DRKT token: " + err.message);
        }
      };
      // Handle stake
      const handleStake = async () => {
        if (!signer || !stakeAmount || parseFloat(stakeAmount) <= 0) {
          setError("Please enter a valid stake amount.");
          return;
        }
        try {
          setLoading(true);
          setError("");
          const amount = ethers.utils.parseEther(stakeAmount);
          const approveTx = await contract.approve(CONTRACT_ADDRESS, amount);
          await approveTx.wait();
          const tx = await contract.stake(amount);
          await tx.wait();
          setStakeAmount("");
          // Refresh data
          const balanceRaw = await contract.balanceOf(account);
          setBalance(ethers.utils.formatEther(balanceRaw));
          const stakeData = await contract.dogeStakes(account);
          setUserStake(ethers.utils.formatEther(stakeData.amount));
          const rewardsRaw = await contract.calculateReward(account);
          setPendingRewards(ethers.utils.formatEther(rewardsRaw));
          const totalStakedRaw = await contract.totalStaked();
          setTotalStaked(ethers.utils.formatEther(totalStakedRaw));
        } catch (err) {
          console.error(err);
          setError("Staking failed: " + (err.message || err.data?.message || "Unknown error"));
        } finally {
          setLoading(false);
        }
      };
      // Handle unstake
      const handleUnstake = async () => {
        if (!signer || !unstakeAmount || parseFloat(unstakeAmount) <= 0) {
          setError("Please enter a valid unstake amount.");
          return;
        }
        try {
          setLoading(true);
          setError("");
          const amount = ethers.utils.parseEther(unstakeAmount);
          const tx = await contract.unstake(amount);
          await tx.wait();
          setUnstakeAmount("");
          // Refresh data
          const balanceRaw = await contract.balanceOf(account);
          setBalance(ethers.utils.formatEther(balanceRaw));
          const stakeData = await contract.dogeStakes(account);
          setUserStake(ethers.utils.formatEther(stakeData.amount));
          const rewardsRaw = await contract.calculateReward(account);
          setPendingRewards(ethers.utils.formatEther(rewardsRaw));
          const totalStakedRaw = await contract.totalStaked();
          setTotalStaked(ethers.utils.formatEther(totalStakedRaw));
        } catch (err) {
          console.error(err);
          setError("Unstaking failed: " + (err.message || err.data?.message || "Unknown error"));
        } finally {
          setLoading(false);
        }
      };
      // Handle claim rewards
      const handleClaimRewards = async () => {
        if (!signer) return;
        try {
          setLoading(true);
          setError("");
          const tx = await contract.claimReward();
          await tx.wait();
          // Refresh data
          const balanceRaw = await contract.balanceOf(account);
          setBalance(ethers.utils.formatEther(balanceRaw));
          const stakeData = await contract.dogeStakes(account);
          setUserStake(ethers.utils.formatEther(stakeData.amount));
          const rewardsRaw = await contract.calculateReward(account);
          setPendingRewards(ethers.utils.formatEther(rewardsRaw));
        } catch (err) {
          console.error(err);
          setError("Claiming rewards failed: " + (err.message || err.data?.message || "Unknown error"));
        } finally {
          setLoading(false);
        }
      };
      // Handle donate to pool
      const handleDonate = async () => {
        if (!signer || !donateAmount || parseFloat(donateAmount) <= 0) {
          setError("Please enter a valid donation amount.");
          return;
        }
        try {
          setLoading(true);
          setError("");
          const amount = ethers.utils.parseEther(donateAmount);
          const approveTx = await contract.approve(CONTRACT_ADDRESS, amount);
          await approveTx.wait();
          const tx = await contract.donateToPool(amount);
          await tx.wait();
          setDonateAmount("");
          // Refresh data
          const balanceRaw = await contract.balanceOf(account);
          setBalance(ethers.utils.formatEther(balanceRaw));
          const rewardPoolRaw = await contract.rewardPool();
          setRewardPool(ethers.utils.formatEther(rewardPoolRaw));
        } catch (err) {
          console.error(err);
          setError("Donation failed: " + (err.message || err.data?.message || "Unknown error"));
        } finally {
          setLoading(false);
        }
      };
      return (
        <>
          <div className="stars"></div>
          <div className="container mx-auto px-4 py-8">
            <header className="text-center py-12">
              <div className="flex justify-center items-center mb-4">
                <img src={LOGO_URL} alt="DogeRocket Logo" className="w-20 h-20" />
              </div>
              <h1 className="text-4xl md:text-5xl font-bold text-white mb-4">DogeRocket (DRKT)</h1>
              <p className="text-lg md:text-xl text-gray-300 mt-4">
                Elevate your portfolio to stellar heights
              </p>
              <div className="mt-8 flex flex-col sm:flex-row justify-between items-center">
                <div className="flex items-center space-x-4">
                  {!account ? (
                    <>
                      <button
                        onClick={connectMetaMask}
                        disabled={loading}
                        className="bg-orange-600 hover:bg-orange-500 text-white font-semibold py-3 px-8 rounded-lg disabled:opacity-50 transition-colors flex items-center"
                      >
                        <i className="ri-wallet-line mr-2 text-xl hover:text-yellow-400 transition-colors"></i>
                        {loading ? "Connecting..." : "Connect MetaMask"}
                      </button>
                      <button
                        onClick={connectWalletConnect}
                        disabled={loading}
                        className="bg-blue-700 hover:bg-blue-600 text-white font-semibold py-3 px-8 rounded-lg disabled:opacity-50 transition-colors flex items-center"
                      >
                        <i className="ri-wallet-line mr-2 text-xl hover:text-yellow-400 transition-colors"></i>
                        {loading ? "Connecting..." : "Connect WalletConnect"}
                      </button>
                    </>
                  ) : (
                    <>
                      <p className="text-white font-semibold">
                        Connected: <span className="font-mono">{account.slice(0, 6)}...{account.slice(-4)}</span>
                      </p>
                      <button
                        onClick={disconnectWallet}
                        className="bg-red-600 hover:bg-red-500 text-white font-semibold py-3 px-8 rounded-lg transition-colors flex items-center"
                      >
                        <i className="ri-logout-box-line mr-2 text-xl hover:text-yellow-400 transition-colors"></i>
                        Disconnect
                      </button>
                    </>
                  )}
                </div>
                <button
                  onClick={addTokenToMetaMask}
                  className="bg-gray-600 hover:bg-gray-500 text-white py-3 px-8 rounded-lg font-semibold transition-colors mt-2 sm:mt-0 flex items-center"
                >
                  <i className="ri-add-line mr-2 text-xl hover:text-yellow-400 transition-colors"></i>
                  Add DRKT to MetaMask
                </button>
              </div>
            </header>
            <section className="bg-white/10 backdrop-blur-sm text-white rounded-xl p-6 mb-8">
              <h2 className="text-2xl font-semibold mb-4">About DogeRocket</h2>
              <p className="text-gray-300 mb-4">
                DogeRocket (DRKT) is a decentralized ERC-20 staking token built on the Polygon blockchain, with a fixed total supply of 1 billion tokens. Users can stake DRKT to generate rewards through a dynamic Annual Percentage Yield (APY) mechanism, ranging from 5.8% to 347%. Token allocation is structured as follows: 20% vested to the DogeDAO over a 10-year period, 40% reserved for staking rewards, and 30% committed to a locked staking rewards pool.
              </p>
              <div className="flex flex-wrap justify-center space-x-4 space-y-2">
                <a href="https://dogerocket.site" target="_blank" rel="noopener noreferrer" className="text-blue-400 hover:text-blue-300 flex items-center">
                  <i className="ri-global-line mr-1 text-xl hover:text-yellow-400 transition-colors"></i>Website
                </a>
                <a href="https://x.com/DRKTDogeRocket" target="_blank" rel="noopener noreferrer" className="text-blue-400 hover:text-blue-300 flex items-center">
                  <i className="ri-twitter-line mr-1 text-xl hover:text-yellow-400 transition-colors"></i>Twitter
                </a>
                <a href="https://discord.gg/9QQ8FmY6nq" target="_blank" rel="noopener noreferrer" className="text-blue-400 hover:text-blue-300 flex items-center">
                  <i className="ri-discord-line mr-1 text-xl hover:text-yellow-400 transition-colors"></i>Discord
                </a>
              </div>
            </section>
            <section className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
              <div className="bg-white/10 backdrop-blur-sm p-6 rounded-xl text-center">
                <h3 className="text-lg font-semibold text-gray-300">Current APY</h3>
                <p className="text-3xl font-bold text-yellow-400">{apy}%</p>
              </div>
              <div className="bg-white/10 backdrop-blur-sm p-6 rounded-xl text-center">
                <h3 className="text-lg font-semibold text-gray-300">Total Staked</h3>
                <p className="text-3xl font-bold">{parseFloat(totalStaked).toLocaleString()} DRKT</p>
              </div>
              <div className="bg-white/10 backdrop-blur-sm p-6 rounded-xl text-center">
                <h3 className="text-lg font-semibold text-gray-300">Reward Pool</h3>
                <p className="text-3xl font-bold">{parseFloat(rewardPool).toLocaleString()} DRKT</p>
              </div>
            </section>
            {account && (
              <>
                <section className="bg-white/10 backdrop-blur-sm text-white rounded-xl p-6 mb-8">
                  <h2 className="text-2xl font-semibold mb-6 text-center">Your Dashboard</h2>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div className="space-y-4">
                      <div className="bg-blue-800/50 p-4 rounded-lg">
                        <h3 className="text-lg font-semibold">Balance</h3>
                        <p className="text-2xl font-bold">{parseFloat(balance).toLocaleString()} DRKT</p>
                      </div>
                      <div className="bg-blue-800/50 p-4 rounded-lg">
                        <h3 className="text-lg font-semibold">Staked</h3>
                        <p className="text-2xl font-bold">{parseFloat(userStake).toLocaleString()} DRKT</p>
                      </div>
                      <div className="bg-green-800/50 p-4 rounded-lg">
                        <h3 className="text-lg font-semibold">Pending Rewards</h3>
                        <p className="text-2xl font-bold text-green-400">{parseFloat(pendingRewards).toLocaleString()} DRKT</p>
                      </div>
                    </div>
                    <div className="space-y-4">
                      <div>
                        <label className="block text-sm font-medium mb-2">Stake Amount</label>
                        <input
                          type="number"
                          step="0.000000000000000001"
                          value={stakeAmount}
                          onChange={(e) => setStakeAmount(e.target.value)}
                          className="w-full p-3 rounded-lg bg-white/10 text-white placeholder-gray-400"
                          placeholder="0.0 DRKT"
                        />
                        <button
                          onClick={handleStake}
                          disabled={loading}
                          className="mt-2 w-full bg-green-600 hover:bg-green-500 text-white py-3 rounded-lg font-semibold disabled:opacity-50 transition-colors"
                        >
                          {loading ? "Staking..." : "Stake DRKT"}
                        </button>
                      </div>
                      <div>
                        <label className="block text-sm font-medium mb-2">Unstake Amount</label>
                        <input
                          type="number"
                          step="0.000000000000000001"
                          value={unstakeAmount}
                          onChange={(e) => setUnstakeAmount(e.target.value)}
                          className="w-full p-3 rounded-lg bg-white/10 text-white placeholder-gray-400"
                          placeholder="0.0 DRKT"
                        />
                        <button
                          onClick={handleUnstake}
                          disabled={loading}
                          className="mt-2 w-full bg-red-600 hover:bg-red-500 text-white py-3 rounded-lg font-semibold disabled:opacity-50 transition-colors"
                        >
                          {loading ? "Unstaking..." : "Unstake DRKT"}
                        </button>
                      </div>
                      <div>
                        <label className="block text-sm font-medium mb-2">Donate to Pool</label>
                        <input
                          type="number"
                          step="0.000000000000000001"
                          value={donateAmount}
                          onChange={(e) => setDonateAmount(e.target.value)}
                          className="w-full p-3 rounded-lg bg-white/10 text-white placeholder-gray-400"
                          placeholder="0.0 DRKT"
                        />
                        <button
                          onClick={handleDonate}
                          disabled={loading}
                          className="mt-2 w-full bg-purple-600 hover:bg-purple-500 text-white py-3 rounded-lg font-semibold disabled:opacity-50 transition-colors"
                        >
                          {loading ? "Donating..." : "Donate DRKT"}
                        </button>
                      </div>
                      <button
                        onClick={handleClaimRewards}
                        disabled={loading || parseFloat(pendingRewards) === 0}
                        className="w-full bg-yellow-600 hover:bg-yellow-500 text-white py-3 rounded-lg font-semibold disabled:opacity-50 transition-colors"
                      >
                        {loading ? "Claiming..." : `Claim ${parseFloat(pendingRewards).toLocaleString()} Rewards`}
                      </button>
                    </div>
                  </div>
                </section>
              </>
            )}
            {error && (
              <div className="bg-red-500/20 border border-red-500 text-red-300 p-4 rounded-lg mb-8">
                {error}
              </div>
            )}
            <footer className="text-center py-8 text-gray-300 border-t border-white/10">
              <p>&copy; 2025 DogeRocket. All rights reserved. | Polygon Mainnet</p>
            </footer>
          </div>
        </>
      );
    }
    ReactDOM.render(<App />, document.getElementById("root"));
  </script>
</body>
</html>
