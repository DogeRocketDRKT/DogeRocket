<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DogeRocket Staking dApp</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/remixicon@4.3.0/fonts/remixicon.css" rel="stylesheet">
  
  <!-- Web3Modal v5+ (ethers v5) - modern UI, unified wallet connect (MetaMask + WalletConnect + others) -->
  <script type="module">
    import { createWeb3Modal, defaultConfig } from 'https://esm.sh/@web3modal/ethers5@5.1.10';

    const projectId = "d2ef0dc4e30bb16fb86b1a73175e2261";

    const metadata = {
      name: "DogeRocket Staking",
      description: "Elevate your portfolio to stellar heights",
      url: window.location.href,
      icons: ["https://gray-past-falcon-384.mypinata.cloud/ipfs/bafkreign7g276yq7ss6cqo7gtnrbvwrh5qbxmhgboamwdoiy5sv5lo6j4i"]
    };

    const polygon = {
      chainId: 137,
      name: "Polygon Mainnet",
      currency: "MATIC",
      explorerUrl: "https://polygonscan.com",
      rpcUrl: "https://polygon-rpc.com"
    };

    window.w3mModal = createWeb3Modal({
      ethersConfig: defaultConfig({
        metadata,
        defaultChainId: 137,
        enableEIP6963: true,
        enableInjected: true,
        enableCoinbase: true
      }),
      chains: [polygon],
      projectId,
      themeMode: "dark",
      themeVariables: {
        "--w3m-accent": "#1E40AF",
        "--w3m-background": "#1E3A8A",
        "--w3m-border-radius-master": "2px"
      },
      enableAnalytics: false,
      enableOnramp: false
    });
  </script>

  <style>
    body { overflow-y: auto; }
  </style>
</head>
<body class="bg-gradient-to-b from-blue-900 to-blue-500 text-white min-h-screen font-sans">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;
    const { ethers } = window.ethers;

    // Production values
    const CONTRACT_ADDRESS = "0x03720Cc99a302C101dbd48489a6c2c8Bb52D178D";
    const CHAIN_ID = 137;
    const RPC_URL = "https://polygon-rpc.com";
    const LOGO_URL = "https://gray-past-falcon-384.mypinata.cloud/ipfs/bafkreign7g276yq7ss6cqo7gtnrbvwrh5qbxmhgboamwdoiy5sv5lo6j4i";
    const SALE_URL = "https://dapp.quickswap.exchange/swap/v3/ETH/0x03720Cc99a302C101dbd48489a6c2c8Bb52D178D";

    const ABI = [
      {"inputs":[],"stateMutability":"nonpayable","type":"constructor"},
      {"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"allowance","type":"uint256"},{"internalType":"uint256","name":"needed","type":"uint256"}],"name":"ERC20InsufficientAllowance","type":"error"},
      {"inputs":[{"internalType":"address","name":"sender","type":"address"},{"internalType":"uint256","name":"balance","type":"uint256"},{"internalType":"uint256","name":"needed","type":"uint256"}],"name":"ERC20InsufficientBalance","type":"error"},
      {"inputs":[{"internalType":"address","name":"approver","type":"address"}],"name":"ERC20InvalidApprover","type":"error"},
      {"inputs":[{"internalType":"address","name":"receiver","type":"address"}],"name":"ERC20InvalidReceiver","type":"error"},
      {"inputs":[{"internalType":"address","name":"sender","type":"address"}],"name":"ERC20InvalidSender","type":"error"},
      {"inputs":[{"internalType":"address","name":"spender","type":"address"}],"name":"ERC20InvalidSpender","type":"error"},
      {"inputs":[{"internalType":"address","name":"owner","type":"address"}],"name":"OwnableInvalidOwner","type":"error"},
      {"inputs":[{"internalType":"address","name":"account","type":"address"}],"name":"OwnableUnauthorizedAccount","type":"error"},
      {"inputs":[{"internalType":"address","name":"token","type":"address"}],"name":"SafeERC20FailedOperation","type":"error"},
      {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"spender","type":"address"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"Approval","type":"event"},
      {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"wallet","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"LockedTokensClaimed","type":"event"},
      {"anonymous":false,"inputs":[{"indexed":false,"internalType":"string","name":"newCID","type":"string"},{"indexed":false,"internalType":"string","name":"newDescription","type":"string"}],"name":"MetadataUpdated","type":"event"},
      {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"previousOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},
      {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"reward","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"timestamp","type":"uint256"}],"name":"RewardClaimed","type":"event"},
      {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"sender","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"RewardPoolContribution","type":"event"},
      {"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"previousPool","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"newPool","type":"uint256"}],"name":"RewardPoolModified","type":"event"},
      {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"RewardsExpired","type":"event"},
      {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"}],"name":"StakePruned","type":"event"},
      {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"TokensStaked","type":"event"},
      {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"fee","type":"uint256"}],"name":"TokensUnstaked","type":"event"},
      {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"wallet","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"VestedTokensClaimed","type":"event"},
      {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"Transfer","type":"event"},
      {"inputs":[],"name":"LOCKED_LOCK_DURATION","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"LOCKED_VESTING_PERIODS","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"MAX_CLAIM_WINDOW","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"MAX_REWARD_RATE","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"MAX_STAKE","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"MAX_STAKE_DURATION","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"MAX_SUPPLY","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"MIN_DONATION","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"MIN_REWARD_RATE","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"MIN_STAKE","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"MIN_STAKE_DURATION","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"STAKE_COOLDOWN","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"STAKING_REWARDS_ALLOCATION","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"TARGET_POOL_COVERAGE","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"WITHDRAW_FEE","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"address","name":"spender","type":"address"}],"name":"allowance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"value","type":"uint256"}],"name":"approve","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},
      {"inputs":[{"internalType":"address","name":"account","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"calculateReward","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"claimLockedToPool","outputs":[],"stateMutability":"nonpayable","type":"function"},
      {"inputs":[],"name":"claimReward","outputs":[],"stateMutability":"nonpayable","type":"function"},
      {"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"claimVested","outputs":[],"stateMutability":"nonpayable","type":"function"},
      {"inputs":[],"name":"contractDescription","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"currentAPY","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"deploymentTime","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"dogeStakes","outputs":[{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"uint256","name":"pendingRewards","type":"uint256"},{"internalType":"uint64","name":"lastUpdateTime","type":"uint64"},{"internalType":"uint64","name":"lastActionTime","type":"uint64"},{"internalType":"uint64","name":"stakeStartTime","type":"uint64"}],"stateMutability":"view","type":"function"},
      {"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"donateToPool","outputs":[],"stateMutability":"nonpayable","type":"function"},
      {"inputs":[],"name":"lockedAmount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"lockedClaimedAmount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"metadataCID","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"name","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"renounceOwnership","outputs":[],"stateMutability":"pure","type":"function"},
      {"inputs":[],"name":"rewardPool","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[{"internalType":"string","name":"newCID","type":"string"},{"internalType":"string","name":"newDescription","type":"string"}],"name":"setMetadata","outputs":[],"stateMutability":"nonpayable","type":"function"},
      {"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"stake","outputs":[],"stateMutability":"nonpayable","type":"function"},
      {"inputs":[],"name":"symbol","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"totalStaked","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"totalSupply","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"value","type":"uint256"}],"name":"transfer","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},
      {"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"value","type":"uint256"}],"name":"transferFrom","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},
      {"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},
      {"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"unstake","outputs":[],"stateMutability":"nonpayable","type":"function"},
      {"inputs":[],"name":"vestedAmount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"vestedClaimedAmount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"}
    ];

    function App() {
      const [provider, setProvider] = useState(null);
      const [signer, setSigner] = useState(null);
      const [contract, setContract] = useState(null);
      const [account, setAccount] = useState(null);
      const [balance, setBalance] = useState("0");
      const [apy, setApy] = useState("0");
      const [totalStaked, setTotalStaked] = useState("0");
      const [rewardPool, setRewardPool] = useState("0");
      const [userStake, setUserStake] = useState("0");
      const [pendingRewards, setPendingRewards] = useState("0");
      const [stakeAmount, setStakeAmount] = useState("");
      const [unstakeAmount, setUnstakeAmount] = useState("");
      const [donateAmount, setDonateAmount] = useState("");
      const [error, setError] = useState("");
      const [loading, setLoading] = useState(false);

      // Initial contract + global data load
      useEffect(() => {
        const init = async () => {
          try {
            const ethersProvider = new ethers.providers.JsonRpcProvider(RPC_URL);
            const contractInstance = new ethers.Contract(CONTRACT_ADDRESS, ABI, ethersProvider);
            setProvider(ethersProvider);
            setContract(contractInstance);

            const [apyRaw, totalStakedRaw, rewardPoolRaw] = await Promise.all([
              contractInstance.currentAPY(),
              contractInstance.totalStaked(),
              contractInstance.rewardPool()
            ]);

            const apyValue = Number(ethers.utils.formatUnits(apyRaw, 0)) / 100;
            setApy(apyValue.toFixed(2));
            setTotalStaked(ethers.utils.formatEther(totalStakedRaw));
            setRewardPool(ethers.utils.formatEther(rewardPoolRaw));
          } catch (err) {
            console.error(err);
            setError("Failed to load contract data.");
          }
        };
        init();
      }, []);

      // Web3Modal subscription - handles connect, disconnect, chain changes, etc.
      useEffect(() => {
        if (!window.w3mModal) return;

        const unsubscribe = window.w3mModal.subscribeProvider(async (state) => {
          const { provider: w3mProvider, isConnected, address, chainId } = state;

          if (!isConnected || !w3mProvider || !address) {
            // Disconnected
            setSigner(null);
            setAccount(null);
            setBalance("0");
            setUserStake("0");
            setPendingRewards("0");
            const rpcProvider = new ethers.providers.JsonRpcProvider(RPC_URL);
            setProvider(rpcProvider);
            setContract(new ethers.Contract(CONTRACT_ADDRESS, ABI, rpcProvider));
            return;
          }

          // Wrong network - auto switch
          if (chainId !== CHAIN_ID) {
            setError("Switching to Polygon Mainnet...");
            try {
              await window.w3mModal.switchNetwork({ chainId: CHAIN_ID });
              return; // callback will fire again after switch
            } catch {
              setError("Please switch to Polygon Mainnet manually");
              return;
            }
          }

          // Connected correctly
          setError("");
          const ethersProvider = new ethers.providers.Web3Provider(w3mProvider, "any");
          const signerInstance = ethersProvider.getSigner();
          const contractWithSigner = new ethers.Contract(CONTRACT_ADDRESS, ABI, signerInstance);

          setProvider(ethersProvider);
          setSigner(signerInstance);
          setAccount(address);
          setContract(contractWithSigner);

          // Refresh user + global data
          try {
            const [balRaw, stakeData, rewardRaw, totalStakedRaw, poolRaw, apyRaw] = await Promise.all([
              contractWithSigner.balanceOf(address),
              contractWithSigner.dogeStakes(address),
              contractWithSigner.calculateReward(address),
              contractWithSigner.totalStaked(),
              contractWithSigner.rewardPool(),
              contractWithSigner.currentAPY()
            ]);

            setBalance(ethers.utils.formatEther(balRaw));
            setUserStake(ethers.utils.formatEther(stakeData.amount));
            setPendingRewards(ethers.utils.formatEther(rewardRaw));
            setTotalStaked(ethers.utils.formatEther(totalStakedRaw));
            setRewardPool(ethers.utils.formatEther(poolRaw));
            const apyValue = Number(ethers.utils.formatUnits(apyRaw, 0)) / 100;
            setApy(apyValue.toFixed(2));
          } catch (err) {
            console.error(err);
          }
        });

        return () => unsubscribe();
      }, []);

      const connectWallet = async () => {
        if (!window.w3mModal) return setError("Web3Modal failed to load");
        setLoading(true);
        setError("");
        try {
          await window.w3mModal.open();
        } catch (err) {
          setError("Connection rejected or failed");
        } finally {
          setLoading(false);
        }
      };

      const disconnectWallet = async () => {
        if (window.w3mModal?.getIsConnected()) {
          await window.w3mModal.disconnect();
        }
      };

      const addTokenToMetaMask = async () => {
        if (!window.ethereum) return setError("MetaMask not detected");
        try {
          await window.ethereum.request({
            method: 'wallet_watchAsset',
            params: {
              type: 'ERC20',
              options: {
                address: CONTRACT_ADDRESS,
                symbol: 'DRKT',
                decimals: 18,
                image: LOGO_URL,
              },
            },
          });
        } catch (err) {
          setError("Failed to add token");
        }
      };

      const handleStake = async () => {
        if (!signer || !stakeAmount || Number(stakeAmount) <= 0) return setError("Enter valid amount");
        setLoading(true);
        setError("");
        try {
          const amount = ethers.utils.parseEther(stakeAmount);
          let tx = await contract.approve(CONTRACT_ADDRESS, amount);
          await tx.wait();
          tx = await contract.stake(amount);
          await tx.wait();
          setStakeAmount("");

          // Refresh everything
          const [bal, stakeData, rew, totalS, pool, apyRaw] = await Promise.all([
            contract.balanceOf(account),
            contract.dogeStakes(account),
            contract.calculateReward(account),
            contract.totalStaked(),
            contract.rewardPool(),
            contract.currentAPY()
          ]);
          setBalance(ethers.utils.formatEther(bal));
          setUserStake(ethers.utils.formatEther(stakeData.amount));
          setPendingRewards(ethers.utils.formatEther(rew));
          setTotalStaked(ethers.utils.formatEther(totalS));
          setRewardPool(ethers.utils.formatEther(pool));
          setApy((Number(ethers.utils.formatUnits(apyRaw, 0)) / 100).toFixed(2));
        } catch (err) {
          setError(getUserFriendlyError(err));
        } finally {
          setLoading(false);
        }
      };

      const handleUnstake = async () => {
        if (!signer || !unstakeAmount || Number(unstakeAmount) <= 0) return setError("Enter valid amount");
        setLoading(true);
        setError("");
        try {
          const amount = ethers.utils.parseEther(unstakeAmount);
          const tx = await contract.unstake(amount);
          await tx.wait();
          setUnstakeAmount("");

          const [bal, stakeData, rew, totalS, pool, apyRaw] = await Promise.all([
            contract.balanceOf(account),
            contract.dogeStakes(account),
            contract.calculateReward(account),
            contract.totalStaked(),
            contract.rewardPool(),
            contract.currentAPY()
          ]);
          setBalance(ethers.utils.formatEther(bal));
          setUserStake(ethers.utils.formatEther(stakeData.amount));
          setPendingRewards(ethers.utils.formatEther(rew));
          setTotalStaked(ethers.utils.formatEther(totalS));
          setRewardPool(ethers.utils.formatEther(pool));
          setApy((Number(ethers.utils.formatUnits(apyRaw, 0)) / 100).toFixed(2));
        } catch (err) {
          setError(getUserFriendlyError(err));
        } finally {
          setLoading(false);
        }
      };

      const handleClaimRewards = async () => {
        if (!signer) return;
        setLoading(true);
        setError("");
        try {
          const tx = await contract.claimReward();
          await tx.wait();

          const [bal, stakeData, rew] = await Promise.all([
            contract.balanceOf(account),
            contract.dogeStakes(account),
            contract.calculateReward(account)
          ]);
          setBalance(ethers.utils.formatEther(bal));
          setUserStake(ethers.utils.formatEther(stakeData.amount));
          setPendingRewards(ethers.utils.formatEther(rew));
        } catch (err) {
          setError(getUserFriendlyError(err));
        } finally {
          setLoading(false);
        }
      };

      const handleDonate = async () => {
        if (!signer || !donateAmount || Number(donateAmount) <= 0) return setError("Enter valid amount");
        setLoading(true);
        setError("");
        try {
          const amount = ethers.utils.parseEther(donateAmount);
          let tx = await contract.approve(CONTRACT_ADDRESS, amount);
          await tx.wait();
          tx = await contract.donateToPool(amount);
          await tx.wait();
          setDonateAmount("");

          const [bal, pool] = await Promise.all([
            contract.balanceOf(account),
            contract.rewardPool()
          ]);
          setBalance(ethers.utils.formatEther(bal));
          setRewardPool(ethers.utils.formatEther(pool));
        } catch (err) {
          setError(getUserFriendlyError(err));
        } finally {
          setLoading(false);
        }
      };

      const getUserFriendlyError = (err) => {
        const msg = err?.message || err?.reason || "";
        if (msg.includes("Too frequent")) return "Action on cooldown (24h). Please wait.";
        if (msg.includes("insufficient")) return "Insufficient balance or allowance";
        if (msg.includes("user rejected")) return "Transaction rejected";
        return "Transaction failed – check console for details";
      };

      return (
        <>
          <div className="container mx-auto px-4 py-8">
            {error && (
              <div className="sticky top-0 z-50 bg-red-600/90 border border-red-500 text-white p-4 rounded-lg mb-8 flex justify-between items-start">
                <span>{error}</span>
                <button onClick={() => setError("")} className="text-xl">×</button>
              </div>
            )}

            <header className="text-center py-12">
              <div className="flex justify-center mb-6">
                <img src={LOGO_URL} alt="DogeRocket Logo" className="w-24 h-24 rounded-full border-4 border-yellow-400" />
              </div>
              <h1 className="text-5xl font-bold mb-4">DogeRocket Staking</h1>
              <p className="text-xl text-gray-300">Elevate your portfolio to stellar heights</p>

              <div className="mt-10 flex flex-col sm:flex-row justify-center items-center gap-6">
                <div className="flex items-center gap-4">
                  {!account ? (
                    <button
                      onClick={connectWallet}
                      disabled={loading}
                      className="bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-4 px-8 rounded-full flex items-center gap-3 text-lg transition"
                    >
                      <i className="ri-wallet-3-line text-2xl"></i>
                      {loading ? "Connecting..." : "Connect Wallet"}
                    </button>
                  ) : (
                    <div className="flex items-center gap-4">
                      <span className="font-mono bg-white/10 px-4 py-2 rounded-full">
                        {account.slice(0, 6)}...{account.slice(-4)}
                      </span>
                      <button
                        onClick={disconnectWallet}
                        className="bg-red-600 hover:bg-red-500 px-6 py-3 rounded-full flex items-center gap-2"
                      >
                        <i className="ri-logout-box-line"></i> Disconnect
                      </button>
                    </div>
                  )}
                </div>

                <div className="flex gap-4">
                  <a
                    href={SALE_URL}
                    target="_blank"
                    rel="noopener noreferrer"
                    className="bg-green-600 hover:bg-green-500 text-white py-3 px-8 rounded-full font-bold flex items-center gap-2 transition"
                  >
                    <i className="ri-swap-line"></i> Swap on Quickswap
                  </a>
                  <button
                    onClick={addTokenToMetaMask}
                    className="bg-gray-700 hover:bg-gray-600 text-white py-3 px-6 rounded-full flex items-center gap-2 transition"
                  >
                    <i className="ri-add-circle-line"></i> Add DRKT Token
                  </button>
                </div>
              </div>
            </header>

            <section className="bg-white/10 backdrop-blur-sm rounded-xl p-8 mb-8">
              <h2 className="text-3xl font-bold mb-6 text-center">About DogeRocket</h2>
              <p className="text-gray-200 text-lg leading-relaxed mb-6">
                DogeRocket (DRKT) is a decentralized ERC-20 staking token on Polygon with a fixed 1B supply.
                Dynamic APY ranges from 5.8% to 347%. Allocation: 20% 10-year vest to DogeDAO,
                40% staking rewards, 30% locked reward pool.
              </p>
              <div className="flex flex-wrap justify-center gap-6 text-blue-300">
                <a href="https://dogerocket.site" target="_blank" rel="noopener noreferrer" className="flex items-center gap-2 hover:text-white transition">
                  <i className="ri-global-line text-2xl"></i> Website
                </a>
                <a href="https://x.com/DRKTDogeRocket" target="_blank" rel="noopener noreferrer" className="flex items-center gap-2 hover:text-white transition">
                  <i className="ri-twitter-x-line text-2xl"></i> Twitter/X
                </a>
                <a href="https://discord.gg/9QQ8FmY6nq" target="_blank" rel="noopener noreferrer" className="flex items-center gap-2 hover:text-white transition">
                  <i className="ri-discord-line text-2xl"></i> Discord
                </a>
              </div>
            </section>

            <section className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
              <div className="bg-white/10 backdrop-blur-sm p-8 rounded-xl text-center">
                <h3 className="text-xl font-semibold text-gray-300">Current APY</h3>
                <p className="text-5xl font-bold text-yellow-400 mt-2">{apy}%</p>
              </div>
              <div className="bg-white/10 backdrop-blur-sm p-8 rounded-xl text-center">
                <h3 className="text-xl font-semibold text-gray-300">Total Staked</h3>
                <p className="text-4xl font-bold mt-2">{parseFloat(totalStaked).toLocaleString(undefined, {maximumFractionDigits: 0})} DRKT</p>
              </div>
              <div className="bg-white/10 backdrop-blur-sm p-8 rounded-xl text-center">
                <h3 className="text-xl font-semibold text-gray-300">Reward Pool</h3>
                <p className="text-4xl font-bold mt-2">{parseFloat(rewardPool).toLocaleString(undefined, {maximumFractionDigits: 0})} DRKT</p>
              </div>
            </section>

            {account && (
              <section className="bg-white/10 backdrop-blur-sm rounded-xl p-8">
                <h2 className="text-3xl font-bold mb-8 text-center">Your Dashboard</h2>
                <div className="grid md:grid-cols-2 gap-10">
                  <div className="space-y-6">
                    <div className="bg-blue-900/50 p-6 rounded-xl">
                      <h3 className="text-xl font-semibold text-gray-300">Wallet Balance</h3>
                      <p className="text-4xl font-bold text-yellow-400">{parseFloat(balance).toLocaleString()} DRKT</p>
                    </div>
                    <div className="bg-blue-900/50 p-6 rounded-xl">
                      <h3 className="text-xl font-semibold text-gray-300">Staked Amount</h3>
                      <p className="text-4xl font-bold text-cyan-400">{parseFloat(userStake).toLocaleString()} DRKT</p>
                    </div>
                    <div className="bg-green-900/50 p-6 rounded-xl">
                      <h3 className="text-xl font-semibold text-gray-300">Pending Rewards</h3>
                      <p className="text-4xl font-bold text-green-400">{parseFloat(pendingRewards).toLocaleString()} DRKT</p>
                    </div>
                  </div>

                  <div className="space-y-6">
                    <div>
                      <label className="block text-lg mb-2">Stake DRKT</label>
                      <input type="number" value={stakeAmount} onChange={e => setStakeAmount(e.target.value)} placeholder="0.0" className="w-full p-4 rounded-lg bg-white/10 text-white text-lg" />
                      <button onClick={handleStake} disabled={loading} className="mt-3 w-full bg-green-600 hover:bg-green-500 disabled:opacity-50 py-4 rounded-full font-bold text-xl transition">
                        {loading ? "Processing..." : "Stake"}
                      </button>
                    </div>

                    <div>
                      <label className="block text-lg mb-2">Unstake DRKT</label>
                      <input type="number" value={unstakeAmount} onChange={e => setUnstakeAmount(e.target.value)} placeholder="0.0" className="w-full p-4 rounded-lg bg-white/10 text-white text-lg" />
                      <button onClick={handleUnstake} disabled={loading} className="mt-3 w-full bg-red-600 hover:bg-red-500 disabled:opacity-50 py-4 rounded-full font-bold text-xl transition">
                        {loading ? "Processing..." : "Unstake"}
                      </button>
                    </div>

                    <div>
                      <label className="block text-lg mb-2">Donate to Reward Pool</label>
                      <input type="number" value={donateAmount} onChange={e => setDonateAmount(e.target.value)} placeholder="0.0" className="w-full p-4 rounded-lg bg-white/10 text-white text-lg" />
                      <button onClick={handleDonate} disabled={loading} className="mt-3 w-full bg-purple-600 hover:bg-purple-500 disabled:opacity-50 py-4 rounded-full font-bold text-xl transition">
                        {loading ? "Processing..." : "Donate"}
                      </button>
                    </div>

                    <button
                      onClick={handleClaimRewards}
                      disabled={loading || Number(pendingRewards) === 0}
                      className="w-full bg-yellow-600 hover:bg-yellow-500 disabled:opacity-50 py-5 rounded-full font-bold text-xl transition"
                    >
                      {loading ? "Claiming..." : `Claim ${parseFloat(pendingRewards).toLocaleString()} DRKT Rewards`}
                    </button>
                  </div>
                </div>
              </section>
            )}

            <footer className="text-center py-12 text-gray-400 border-t border-white/10 mt-16">
              <p>&copy; 2025 DogeRocket • Polygon Mainnet • All Rights Reserved</p>
            </footer>
          </div>
        </>
      );
    }

    ReactDOM.render(<App />, document.getElementById("root"));
  </script>
</body>
</html>
